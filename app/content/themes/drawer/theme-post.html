<dom-module id="theme-post">
  <template>
    <style>
      .featured-image .image {
        position: absolute;
        left: 0px;
        right: 0px;
        margin-top: -20px;
      }
      .featured-image .image div {
        position: fixed;
        width: 100%;
        height: calc(15vw + 100px);
        background-size: cover;
      }
      .featured-image .spacer {
        height: calc(15vw - 100px);
      }
      .header {
        padding: 0px 20px 10px 20px;
      }
      .featured-image .header {
        color: #ffffff;
        text-shadow: #000000 0px 0px 12px;
      }
      .content {
        width: 100%;
        margin: 0px 0px 20px 0px;
      }
      .meta {
        margin: 20px 5px 5px 5px;
      }
      .meta div {
        margin: 0px 5px 5px 5px;
      }
    </style>
    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>

    <template is="dom-if" if="[[!featuredImage]]">
      <div class="header">
        <div class="layout horizontal justified">
          <div>
            <h1>[[post.title]]</h1>
          </div>
          <div class="meta" style="text-align:right;font-size:18px">
            <div style="font-weight:bold">[[date]]</div>
            <div>[[author.displayName]]</div>
          </div>
        </div>
      </div>
      <paper-card class="content" elevation="3">
        <div class="card-content">
          <post-content post="[[post]]" ></post-content>
        </div>
      </paper-card>
    </template>

    <template is="dom-if" if="[[featuredImage]]">
      <div class="featured-image">
        <div class="image" style="z-index:-1">
          <div style$="background-image:url('[[featuredImage]]')"></div>
        </div>
        <div class="header">
          <div class="layout horizontal justified">
            <div>
              <h1>[[post.title]]</h1>
            </div>
            <div class="meta" style="text-align:right;font-size:18px">
              <div style="font-weight:bold">[[date]]</div>
              <div>[[author.displayName]]</div>
            </div>
          </div>
        </div>
        <div class="spacer"></div>
        <paper-card class="content" elevation="3">
          <div class="card-content">
            <post-content post="[[post]]" ></post-content>
          </div>
        </paper-card>
      </div>
    </template>

    <template is="dom-if" if="[[post.taxonomy.disqus]]">
      <paper-card class="content" elevation="3">
        <div class="card-content">
          <load-module name="disqus" propPost="[[post]]"></load-module>
        </div>
      </paper-card>
    </template>

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'theme-post',

        behaviors: [ ReduxBehavior ],

        properties: {
          post: {
            type: Object,
            value: {}
          },
          authors: {
            type: Object,
            statePath: 'authors'
          },
          settings: {
            type: Object,
            statePath: 'settings'
          },
          author: {
            type: Object,
            value: {}
          },
          date: {
            type: String,
            value: ''
          },
          disqusProperties: {
            type: Object,
            value: {}
          }
        },

        ready: function() {
          if (this.post.author) this.set('author', this.authors[this.post.author]);
          if (this.post.date) this.set('date', this.post.date.format(this.settings.dateFormat));
        },

        attached: function() {
          app.loadImage(this.post).then((image) => {
            this.set('featuredImage', image);
          });
        }
      });
    })();
  </script>
</dom-module>
