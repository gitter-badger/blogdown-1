<dom-module id="boot-meta">
  <script>
    class BootMeta {
      beforeRegister() {
        this.is = 'boot-meta';

        this.actions = {
          setBaseUrl: (baseUrl) => {
            return (dispatch) => {
              dispatch({
                type: SET_BASE_URL,
                baseUrl: baseUrl
              });
              return app.runHook('baseUrlSet');
            }
          }
        }
      }

      get behaviors() {
        return [ ReduxBehavior ];
      }

      init() {
        let promises = [this.setBaseUrl()];
        return Promise.all(promises);
      }

      setBaseUrl() {
        let matches = window.location.href.match(/[\w\d\.:\/\\]+(?=\/#!)/g);
        let baseUrl = window.location.href;
        if (matches) {
          baseUrl = matches[0];
        } else {
          if (baseUrl[baseUrl.length - 1] === '/') baseUrl = baseUrl.substring(0, baseUrl.length - 1);
        }
        return this.dispatch('setBaseUrl', baseUrl);
      }
    }
    Polymer(BootMeta);
  </script>
</dom-module>
