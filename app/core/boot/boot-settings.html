<dom-module id="boot-settings">
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'boot-settings',

        behaviors: [ ReduxBehavior ],

        actions: {
          loadSettings: () => {
            return function(dispatch) {
              return fetch('../../../content/settings.json?' + moment().format('X')).then((res) => {
                return res.json();
              }).then((body) => {
                var settings = {};
                _.each(body, (setting, key) => {
                  if (key === 'logLevel') return settings[key] = {
                    name: setting,
                    value: this.getLogLevel(setting)
                  };
                  return settings[key] = setting;
                });
                dispatch({
                  type: LOAD_SETTINGS,
                  settings: settings
                });
                this.resolve(settings);
                return settings;
              }).catch((err) => {
                this.reject(err);
                throw err;
              });
            }
          }
        },

        init: function() {
          console.log('loading settings . . .');
          return new Promise((resolve, reject) => {
            this.resolve = resolve;
            this.reject = reject;
            this.dispatch('loadSettings');
          });
        },

        getLogLevel: function(debug) {
          if (typeof debug === 'number') return debug;
          switch(debug) {
            case 'silent':
              return 0;
            case 'error':
              return 1;
            case 'warn':
              return 2;
            case 'info':
              return 3;
            case 'debug':
              return 4;
            case 'silly':
              return 5;
            default:
              return 3;
          }
        }
      });
    })();
  </script>
</dom-module>
