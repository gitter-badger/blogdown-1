<dom-module id="boot-theme">
  <script>
    class BootTheme {
      beforeRegister() {
        this.is = 'boot-theme';

        this.properties = {
          baseUrl: {
            type: String,
            statePath: 'meta.baseUrl'
          },
          theme: {
            type: Object,
            statePath: 'settings.theme'
          }
        };
      }

      get behaviors() {
        return [ReduxState];
      }

      init() {
        return this.importTheme().then(() => {
          app.runHook('themeImported');
          return;
        });
      }

      importTheme() {
        return this.importHrefPromise(
          `${this.baseUrl}/content/themes/${this.theme}/theme-body.html`
          + `?${moment().format('x')}`
        ).then(() => {
          return this.importHrefPromise(
            `${this.baseUrl}/content/themes/${this.theme}/theme-page.html`
            + `?${moment().format('x')}`
          );
        }).then(() => {
          return this.importHrefPromise(
            `${this.baseUrl}/content/themes/${this.theme}/theme-posts.html`
            + `?${moment().format('x')}`
          );
        }).then(() => {
          return this.importHrefPromise(
            `${this.baseUrl}/content/themes/${this.theme}/theme-post.html`
            + `?${moment().format('x')}`
          );
        });
      }

      importHrefPromise(url) {
        return new Promise((resolve, reject) => {
          this.importHref(url, () => {
            resolve();
          }, (err) => {
            reject(err);
          });
        });
      }
    }
    Polymer(BootTheme);
  </script>
</dom-module>
